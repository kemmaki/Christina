<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Blow Out the Candles</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: radial-gradient(circle at top, #555, #111);
        color: white;
        text-align: center;
        padding-top: 30px;
    }

    h1 { margin-bottom: 5px; }

    #cake {
        position: relative;
        width: 420px;
        height: 240px;
        margin: 40px auto 0;
        background: linear-gradient(#f7b27a, #c96a28);
        border-radius: 20px;
        box-shadow:
            inset 0 10px 0 rgba(255,255,255,0.2),
            inset 0 -15px 0 rgba(0,0,0,0.3),
            0 20px 30px rgba(0,0,0,0.7);
        overflow: hidden;
    }

    #cake::before {
        content: "";
        position: absolute;
        top: 0;
        width: 100%;
        height: 55px;
        background: linear-gradient(#fff, #ffe4ec);
        border-radius: 20px 20px 10px 10px;
    }

    #cake::after {
        content: "";
        position: absolute;
        top: 45px;
        width: 100%;
        height: 40px;
        background:
            radial-gradient(circle at 10% 0, #ffe4ec 20px, transparent 21px),
            radial-gradient(circle at 35% 0, #ffe4ec 25px, transparent 26px),
            radial-gradient(circle at 60% 0, #ffe4ec 18px, transparent 19px),
            radial-gradient(circle at 85% 0, #ffe4ec 22px, transparent 23px);
    }

    /* Candle holder */
    .candles {
        position: absolute;
        top: -20px;
        width: 100%;
        display: flex;
        justify-content: center;
        gap: 14px;
        z-index: 10;
        flex-wrap: wrap;
        padding: 0 10px;
    }

    .candle {
        position: relative;
        width: 18px;
        height: 70px;
        background: repeating-linear-gradient(
            45deg,
            white,
            white 5px,
            pink 5px,
            pink 10px
        );
        border-radius: 5px;
        cursor: pointer;
    }

    /* PERFECTLY CENTERED FLAME */
    .flame {
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        width: 14px;
        height: 20px;
        background: radial-gradient(circle at bottom, yellow, orange, red);
        border-radius: 50%;
        box-shadow: 0 0 15px orange;
        animation: flicker 0.12s infinite;
        pointer-events: none;
    }

    @keyframes flicker {
        0% { transform: translateX(-50%) scale(1); }
        50% { transform: translateX(-50%) scale(1.2); }
        100% { transform: translateX(-50%) scale(1); }
    }

    .wax {
        position: absolute;
        bottom: -10px;
        left: 4px;
        width: 10px;
        height: 0;
        background: #fff;
        border-radius: 5px;
        transition: height 2s linear;
    }

    .smoke {
        position: absolute;
        bottom: 100%;
        left: 50%;
        width: 20px;
        height: 20px;
        background: rgba(200,200,200,0.6);
        border-radius: 50%;
        transform: translateX(-50%);
        animation: smoke 1.5s forwards;
    }

    @keyframes smoke {
        from { opacity: 1; transform: translateX(-50%) scale(0.6); }
        to { opacity: 0; transform: translateX(-50%) translateY(-40px) scale(1.5); }
    }

    .out .flame { display: none; }

    #plate {
        width: 480px;
        height: 30px;
        background: #eee;
        border-radius: 50%;
        margin: 10px auto;
        box-shadow: 0 10px 20px rgba(0,0,0,0.6);
    }

    #message {
        font-size: 24px;
        margin-top: 20px;
    }
</style>
</head>
<body>

<h1>ðŸŽ‚ Blow Out the Candles!</h1>
<p>Blow into your mic or click the candles</p>

<div id="cake">
    <div class="candles" id="candles"></div>
</div>
<div id="plate"></div>

<div id="message"></div>

<script>
const age = Math.min(parseInt(prompt("How old are you? ðŸŽ‰")) || 5, 30);
const candleHolder = document.getElementById("candles");
const message = document.getElementById("message");

for (let i = 0; i < age; i++) {
    const candle = document.createElement("div");
    candle.className = "candle";
    candle.innerHTML = `<div class="flame"></div><div class="wax"></div>`;
    candleHolder.appendChild(candle);
    candle.addEventListener("click", () => blowOut(candle));
}

function blowOut(candle) {
    if (candle.classList.contains("out")) return;
    candle.classList.add("out");

    const smoke = document.createElement("div");
    smoke.className = "smoke";
    candle.appendChild(smoke);

    candle.querySelector(".wax").style.height = "20px";
    setTimeout(() => smoke.remove(), 1500);
    checkWin();
}

function checkWin() {
    const candles = document.querySelectorAll(".candle");
    if ([...candles].every(c => c.classList.contains("out"))) {
        message.textContent = "ðŸŽ‰ Happy Birthday!!! ðŸŽ‰";
    }
}

/* Microphone blowing */
navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
    const audioContext = new AudioContext();
    const mic = audioContext.createMediaStreamSource(stream);
    const analyser = audioContext.createAnalyser();
    mic.connect(analyser);
    const data = new Uint8Array(analyser.frequencyBinCount);

    function detectBlow() {
        analyser.getByteFrequencyData(data);
        const volume = data.reduce((a, b) => a + b) / data.length;
        if (volume > 40) {
            document.querySelectorAll(".candle:not(.out)").forEach(c => {
                if (Math.random() > 0.6) blowOut(c);
            });
        }
        requestAnimationFrame(detectBlow);
    }
    detectBlow();
});
</script>

</body>
</html>
